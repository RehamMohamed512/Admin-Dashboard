<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Users - DataTables</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"/>

    <!-- animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

  <!-- Toastr CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"/>

  <style>
    .fav {
      color: gold;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h2 class="mb-3 animate__animated animate__bounceInUp">Users</h2>

    <table id="usersTable" class="display table table-striped table-bordered animate__animated animate__bounceInUp" style="width:100%">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>City</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

  <!-- DataTables JS -->
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Toastr JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

  <script>
    $(document).ready(function () {
   
      let favorites = JSON.parse(localStorage.getItem("favorites")) || [];

     
      const table = $('#usersTable').DataTable();

     
      fetch("https://jsonplaceholder.typicode.com/users")
        .then(res => res.json())
        .then(users => {
          users.forEach(u => {
            const isFav = favorites.includes(u.id);
            table.row.add([
              u.id,
              u.name,
              u.email,
              u.address.city,
              `
              <button class="btn btn-sm btn-info view-btn"><i class="fa fa-eye"></i></button>
              <button class="btn btn-sm btn-warning edit-btn"><i class="fa fa-edit"></i></button>
              <button class="btn btn-sm btn-danger delete-btn"><i class="fa fa-trash"></i></button>
              <button class="btn btn-sm fav-btn ${isFav ? 'fav' : ''}"><i class="fa fa-star"></i></button>
              `
            ]).draw(false);
          });
        });

      $('#usersTable tbody').on('click', '.view-btn', function () {
        const data = table.row($(this).parents('tr')).data();
        toastr.info(` Viewing user: ${data[1]} (${data[2]})`);
      });

      $('#usersTable tbody').on('click', '.edit-btn', function () {
        const data = table.row($(this).parents('tr')).data();
        toastr.warning(` Editing user: ${data[1]}`);
      });

  
      $('#usersTable tbody').on('click', '.delete-btn', function () {
        const row = table.row($(this).parents('tr'));
        const data = row.data();
        row.remove().draw();
        toastr.error(`Deleted user: ${data[1]}`);
      });

  
      $('#usersTable tbody').on('click', '.fav-btn', function () {
        const row = table.row($(this).parents('tr'));
        const data = row.data();
        const userId = data[0];

        if (favorites.includes(userId)) {
          favorites = favorites.filter(id => id !== userId);
          $(this).removeClass('fav');
          toastr.info(`⭐ Removed from favorites: ${data[1]}`);
        } else {
          favorites.push(userId);
          $(this).addClass('fav');
          toastr.success(`⭐ Added to favorites: ${data[1]}`);
        }

        localStorage.setItem("favorites", JSON.stringify(favorites));
      });
    });
  </script>
</body>
</html>
